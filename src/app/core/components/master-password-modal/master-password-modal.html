<div class="modal-backdrop" (click)="onCancel()" (keydown)="onKeyDown($event)">
  <div class="modal" (click)="$event.stopPropagation()">
    <div class="modal__header">
      <h2 class="modal__title">Master Password</h2>
      <button class="modal__close" (click)="onCancel()" aria-label="Close">
        <i class="lucide icon-x" aria-hidden="true"></i>
      </button>
    </div>

    <form [formGroup]="form" (ngSubmit)="onSubmit()" class="modal__content">
      @if (purpose()) {
        <p class="modal__description">Enter your Master Password to {{ purpose() }}</p>
      }

      <div class="form-field">
        <label for="masterPassword" class="form-label">
          Master Password <span class="required">*</span>
        </label>
        <div class="input-with-icon">
          <input
            #passwordInput
            id="masterPassword"
            [type]="showPassword() ? 'text' : 'password'"
            formControlName="masterPassword"
            placeholder="Enter your Master Password"
            class="form-input"
            [class.error]="masterPassword?.invalid && masterPassword?.touched"
          />
          <button
            type="button"
            class="icon-btn"
            (click)="togglePasswordVisibility()"
            [title]="showPassword() ? 'Hide password' : 'Show password'"
          >
            <i
              class="lucide"
              [ngClass]="showPassword() ? 'icon-eye-off' : 'icon-eye'"
              aria-hidden="true"
            ></i>
          </button>
        </div>
        @if (masterPassword?.invalid && masterPassword?.touched) {
          <div class="error-message">
            @if (masterPassword?.errors?.['required']) {
              <span>Master Password is required</span>
            }
            @if (masterPassword?.errors?.['minlength']) {
              <span>Master Password must be at least 8 characters</span>
            }
          </div>
        }
      </div>

      <div class="modal__footer">
        <button type="button" class="modal__btn modal__btn--secondary" (click)="onCancel()">
          Cancel
        </button>
        <button type="submit" class="modal__btn modal__btn--primary" [disabled]="form.invalid">
          Confirm
        </button>
      </div>
    </form>
  </div>
</div>
