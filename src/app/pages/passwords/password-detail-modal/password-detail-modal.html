<div class="modal-backdrop" (click)="onClose()">
  <div class="modal" (click)="$event.stopPropagation()" [formGroup]="form">
    <div class="modal__header">
      <input
        class="modal__title-input"
        formControlName="title"
        [disabled]="!editing()"
        aria-label="Título"
      />
      <button class="modal__close" (click)="onClose()" aria-label="Fechar">
        <i class="lucide icon-x" aria-hidden="true"></i>
      </button>
    </div>
    <div class="modal__content">
      @if (copyMessage()) {
      <div class="copy-toast" role="status">{{ copyMessage() }}</div>
      }

      <div class="modal__field">
        <label class="modal__label">Nome de Usuário</label>
        <div class="modal__value-wrapper">
          <input class="modal__input" formControlName="username" [disabled]="!editing()" />
          @if (form.get('username')?.invalid && form.get('username')?.touched && editing()) {
          <span class="modal__error">Campo obrigatório</span>
          }
          <button
            class="modal__copy-btn"
            (click)="copyToClipboard(form.get('username')?.value || secret().username)"
            title="Copiar"
          >
            <i class="lucide icon-copy" aria-hidden="true"></i>
          </button>
        </div>
      </div>

      <div class="modal__field">
        <label class="modal__label">Senha</label>
        <div class="modal__value-wrapper">
          <input
            [type]="passwordInputType"
            class="modal__input modal__value--password"
            formControlName="password"
            [disabled]="!editing()"
          />
          @if (form.get('password')?.invalid && form.get('password')?.touched && editing()) {
          <span class="modal__error">Campo obrigatório</span>
          }
          <button
            class="modal__icon-btn"
            type="button"
            (click)="togglePasswordVisibility()"
            [attr.title]="showPassword() ? 'Ocultar senha' : 'Visualizar senha'"
            aria-label="Visualizar senha"
          >
            <i
              class="lucide"
              [ngClass]="showPassword() ? 'icon-eye-off' : 'icon-eye'"
              aria-hidden="true"
            ></i>
          </button>
          <button
            class="modal__copy-btn"
            (click)="copyToClipboard(form.get('password')?.value || secret().password)"
            title="Copiar"
          >
            <i class="lucide icon-copy" aria-hidden="true"></i>
          </button>
        </div>
      </div>

      @if (secret().url) {
      <div class="modal__field">
        <label class="modal__label">URL</label>
        <div class="modal__value-wrapper">
          <a [href]="secret().url" target="_blank" rel="noopener noreferrer" class="modal__link">
            {{ secret().url }}
          </a>
          <button class="modal__copy-btn" (click)="copyToClipboard(secret().url!)" title="Copiar">
            <i class="lucide icon-copy" aria-hidden="true"></i>
          </button>
        </div>
      </div>
      } @if (secret().notes) {
      <div class="modal__field">
        <label class="modal__label">Notas</label>
        <div class="modal__value-wrapper">
          <p class="modal__value modal__value--notes">{{ secret().notes }}</p>
        </div>
      </div>
      } @if (secret().createdAt) {
      <div class="modal__field">
        <label class="modal__label">Criado em</label>
        <span class="modal__value modal__value--date">{{
          secret().createdAt | date : 'dd/MM/yyyy HH:mm'
        }}</span>
      </div>
      } @if (secret().updatedAt) {
      <div class="modal__field">
        <label class="modal__label">Atualizado em</label>
        <span class="modal__value modal__value--date">{{
          secret().updatedAt | date : 'dd/MM/yyyy HH:mm'
        }}</span>
      </div>
      }
    </div>

    <div class="modal__footer">
      @if (!editing()) {
      <button
        class="modal__btn modal__btn--danger"
        (click)="deleteSecret()"
        [disabled]="isDeleting()"
      >
        <i class="lucide icon-trash-2" aria-hidden="true"></i>
        @if (!isDeleting()) {
        <span>Excluir</span>
        } @else {
        <span>Excluindo...</span>
        }
      </button>
      }

      <div style="flex: 1"></div>

      <button
        class="modal__btn modal__btn--secondary"
        (click)="onClose()"
        [disabled]="isSaving() || isDeleting()"
      >
        Fechar
      </button>

      @if (!editing()) {
      <button class="modal__btn modal__btn--primary" (click)="enterEdit()">
        <i class="lucide icon-edit" aria-hidden="true"></i>
        Editar
      </button>
      } @else {
      <button
        class="modal__btn modal__btn--secondary"
        (click)="cancelEdit()"
        [disabled]="isSaving()"
      >
        Cancelar
      </button>
      <button
        class="modal__btn modal__btn--primary"
        (click)="save()"
        [disabled]="isSaving() || form.invalid"
      >
        <i class="lucide icon-save" aria-hidden="true"></i>
        @if (!isSaving()) {
        <span>Salvar</span>
        } @else {
        <span>Salvando...</span>
        }
      </button>
      }
    </div>
  </div>
</div>
