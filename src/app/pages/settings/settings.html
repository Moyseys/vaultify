<div class="settings">
  <div class="settings__header">
    <h1 class="settings__title">Settings</h1>
    <p class="settings__subtitle">Configure your preferences and security</p>
  </div>

  <div class="settings__content">
    <div class="settings__sections">
      <!-- Seção Geral -->
      <div class="settings__section">
        <h2 class="settings__section-title">
          <i class="lucide icon-user" aria-hidden="true"></i>
          General
        </h2>
        <div class="settings__section-content">
          <div class="settings__item">
            <label class="settings__label">Theme</label>
            <select class="settings__select">
              <option value="light">Light</option>
              <option value="dark">Dark</option>
              <option value="auto">Automatic</option>
            </select>
          </div>

          <div class="settings__item">
            <label class="settings__label">Language</label>
            <select class="settings__select">
              <option value="pt-BR">Português (Brasil)</option>
              <option value="en-US">English (US)</option>
            </select>
          </div>
        </div>
      </div>

      <!-- Seção Segurança -->
      <div class="settings__section">
        <h2 class="settings__section-title">
          <i class="lucide icon-shield" aria-hidden="true"></i>
          Security
        </h2>
        <div class="settings__section-content">
          <!-- Secret Key -->
          <div class="settings__item settings__item--secret-key">
            <div class="settings__item-header">
              <label class="settings__label">
                <i class="lucide icon-key" aria-hidden="true"></i>
                Secret Key
              </label>
              @if (checkingSecretKey()) {
                <span class="settings__status settings__status--checking">Checking...</span>
              } @else if (hasSecretKey()) {
                <span class="settings__status settings__status--configured">
                  <i class="lucide icon-check-circle" aria-hidden="true"></i>
                  Configured
                </span>
              } @else {
                <span class="settings__status settings__status--missing">
                  <i class="lucide icon-alert-circle" aria-hidden="true"></i>
                  Not configured
                </span>
              }
            </div>
            <p class="settings__description">
              The Secret Key is used to encrypt your passwords. Keep it in a safe place.
            </p>

            @if (!hasSecretKey()) {
              <form
                [formGroup]="secretKeyForm"
                (ngSubmit)="onSubmitSecretKey()"
                class="settings__form"
              >
                <div class="form-group">
                  <label for="secretKey" class="form-label">Enter your Secret Key</label>
                  <div class="input-with-icon">
                    <input
                      id="secretKey"
                      [type]="showSecretKey() ? 'text' : 'password'"
                      app-input
                      formControlName="secretKey"
                      placeholder="Enter a secure Secret Key"
                      [class.error]="
                        secretKeyForm.get('secretKey')?.invalid &&
                        secretKeyForm.get('secretKey')?.touched
                      "
                    />
                    <button
                      type="button"
                      class="password-toggle-btn"
                      (click)="toggleSecretKeyVisibility()"
                      aria-label="Show/hide secret key"
                    >
                      <i
                        class="lucide"
                        [ngClass]="showSecretKey() ? 'icon-eye-off' : 'icon-eye'"
                        aria-hidden="true"
                      ></i>
                    </button>
                  </div>
                  @if (
                    secretKeyForm.get('secretKey')?.invalid &&
                    secretKeyForm.get('secretKey')?.touched
                  ) {
                    <div class="error-message">
                      @if (secretKeyForm.get('secretKey')?.errors?.['required']) {
                        <span>Secret Key is required</span>
                      }
                      @if (secretKeyForm.get('secretKey')?.errors?.['minlength']) {
                        <span>Secret Key must be at least 6 characters</span>
                      }
                    </div>
                  }
                </div>

                <div class="form-group">
                  <label for="confirmSecretKey" class="form-label">Confirm your Secret Key</label>
                  <div class="input-with-icon">
                    <input
                      id="confirmSecretKey"
                      [type]="showConfirmSecretKey() ? 'text' : 'password'"
                      app-input
                      formControlName="confirmSecretKey"
                      placeholder="Enter the Secret Key again"
                      [class.error]="
                        (secretKeyForm.get('confirmSecretKey')?.invalid &&
                          secretKeyForm.get('confirmSecretKey')?.touched) ||
                        hasSecretKeyMismatch
                      "
                    />
                    <button
                      type="button"
                      class="password-toggle-btn"
                      (click)="toggleConfirmSecretKeyVisibility()"
                      aria-label="Show/hide secret key confirmation"
                    >
                      <i
                        class="lucide"
                        [ngClass]="showConfirmSecretKey() ? 'icon-eye-off' : 'icon-eye'"
                        aria-hidden="true"
                      ></i>
                    </button>
                  </div>
                  @if (
                    (secretKeyForm.get('confirmSecretKey')?.invalid &&
                      secretKeyForm.get('confirmSecretKey')?.touched) ||
                    hasSecretKeyMismatch
                  ) {
                    <div class="error-message">
                      @if (secretKeyForm.get('confirmSecretKey')?.errors?.['required']) {
                        <span>Secret Key confirmation is required</span>
                      }
                      @if (hasSecretKeyMismatch) {
                        <span>Secret Keys do not match</span>
                      }
                    </div>
                  }
                </div>

                <div class="settings__form-actions">
                  <button
                    type="submit"
                    app-button
                    zType="default"
                    zSize="default"
                    [disabled]="creatingSecretKey()"
                  >
                    {{ creatingSecretKey() ? 'Saving...' : 'Save Secret Key' }}
                  </button>
                </div>
              </form>
            }
          </div>
        </div>
      </div>

      <!-- Seção Backup -->
      <div class="settings__section">
        <h2 class="settings__section-title">
          <i class="lucide icon-database" aria-hidden="true"></i>
          Backup and Synchronization
        </h2>
        <div class="settings__section-content">
          <div class="settings__item">
            <div class="settings__toggle">
              <input type="checkbox" id="auto-backup" class="settings__checkbox" />
              <label for="auto-backup" class="settings__toggle-label"> Automatic backup </label>
            </div>
          </div>

          <div class="settings__actions">
            <button class="settings__btn settings__btn--secondary">
              <i class="lucide icon-download" aria-hidden="true"></i>
              Export Data
            </button>
            <button class="settings__btn settings__btn--secondary">
              <i class="lucide icon-upload" aria-hidden="true"></i>
              Import Data
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
