<div class="settings">
  <div class="settings__header">
    <h1 class="settings__title">Settings</h1>
    <p class="settings__subtitle">Configure your preferences and security</p>
  </div>

  <div class="settings__content">
    <div class="settings__sections">
      <!-- Seção Geral -->
      <div class="settings__section">
        <h2 class="settings__section-title">
          <i class="lucide icon-user" aria-hidden="true"></i>
          General
        </h2>
        <div class="settings__section-content">
          <div class="settings__item">
            <label class="settings__label">Theme</label>
            <select class="settings__select">
              <option value="light">Light</option>
              <option value="dark">Dark</option>
              <option value="auto">Automatic</option>
            </select>
          </div>

          <div class="settings__item">
            <label class="settings__label">Language</label>
            <select class="settings__select">
              <option value="pt-BR">Português (Brasil)</option>
              <option value="en-US">English (US)</option>
            </select>
          </div>
        </div>
      </div>

      <!-- Seção Segurança -->
      <div class="settings__section">
        <h2 class="settings__section-title">
          <i class="lucide icon-shield" aria-hidden="true"></i>
          Security
        </h2>
        <div class="settings__section-content">
          <!-- Secret Key -->
          <div class="settings__item settings__item--secret-key">
            <div class="settings__item-header">
              <label class="settings__label">
                <i class="lucide icon-key" aria-hidden="true"></i>
                Secret Key
              </label>
              @if (checkingSecretKey()) {
                <span class="settings__status settings__status--checking">Checking...</span>
              } @else if (hasSecretKey()) {
                <span class="settings__status settings__status--configured">
                  <i class="lucide icon-check-circle" aria-hidden="true"></i>
                  Configured
                </span>
              } @else {
                <span class="settings__status settings__status--missing">
                  <i class="lucide icon-alert-circle" aria-hidden="true"></i>
                  Not configured
                </span>
              }
            </div>
            <p class="settings__description">
              The Secret Key is used to encrypt your passwords. Keep it in a safe place.
            </p>

            @if (!hasSecretKey()) {
              <button
                type="button"
                class="settings__advanced-toggle"
                (click)="toggleAdvancedSettings()"
              >
                <i
                  class="lucide"
                  [ngClass]="showAdvancedSettings() ? 'icon-chevron-down' : 'icon-chevron-right'"
                  aria-hidden="true"
                ></i>
                Advanced Security Settings
                @if (showAdvancedSettings()) {
                  <span class="settings__advanced-badge">Custom</span>
                }
              </button>

              <form
                [formGroup]="secretKeyForm"
                (ngSubmit)="onSubmitSecretKey()"
                class="settings__form"
              >
                <div class="form-group">
                  <label for="secretKey" class="form-label">Enter your Secret Key</label>
                  <div class="input-with-icon">
                    <input
                      id="secretKey"
                      [type]="showSecretKey() ? 'text' : 'password'"
                      app-input
                      formControlName="secretKey"
                      placeholder="Enter a secure Secret Key"
                      [class.error]="
                        secretKeyForm.get('secretKey')?.invalid &&
                        secretKeyForm.get('secretKey')?.touched
                      "
                    />
                    <button
                      type="button"
                      class="password-toggle-btn"
                      (click)="toggleSecretKeyVisibility()"
                      aria-label="Show/hide secret key"
                    >
                      <i
                        class="lucide"
                        [ngClass]="showSecretKey() ? 'icon-eye-off' : 'icon-eye'"
                        aria-hidden="true"
                      ></i>
                    </button>
                  </div>
                  @if (
                    secretKeyForm.get('secretKey')?.invalid &&
                    secretKeyForm.get('secretKey')?.touched
                  ) {
                    <div class="error-message">
                      @if (secretKeyForm.get('secretKey')?.errors?.['required']) {
                        <span>Secret Key is required</span>
                      }
                      @if (secretKeyForm.get('secretKey')?.errors?.['minlength']) {
                        <span>Secret Key must be at least 12 characters</span>
                      }
                      @if (secretKeyForm.get('secretKey')?.errors?.['maxlength']) {
                        <span>Secret Key must not exceed 128 characters</span>
                      }
                      @if (secretKeyForm.get('secretKey')?.errors?.['passwordStrength']) {
                        <span>
                          {{
                            secretKeyForm.get('secretKey')?.errors?.['passwordStrength']?.message
                          }}
                        </span>
                      }
                    </div>
                  }
                </div>

                <div class="form-group">
                  <label for="confirmSecretKey" class="form-label">Confirm your Secret Key</label>
                  <div class="input-with-icon">
                    <input
                      id="confirmSecretKey"
                      [type]="showConfirmSecretKey() ? 'text' : 'password'"
                      app-input
                      formControlName="confirmSecretKey"
                      placeholder="Enter the Secret Key again"
                      [class.error]="
                        (secretKeyForm.get('confirmSecretKey')?.invalid &&
                          secretKeyForm.get('confirmSecretKey')?.touched) ||
                        hasSecretKeyMismatch
                      "
                    />
                    <button
                      type="button"
                      class="password-toggle-btn"
                      (click)="toggleConfirmSecretKeyVisibility()"
                      aria-label="Show/hide secret key confirmation"
                    >
                      <i
                        class="lucide"
                        [ngClass]="showConfirmSecretKey() ? 'icon-eye-off' : 'icon-eye'"
                        aria-hidden="true"
                      ></i>
                    </button>
                  </div>
                  @if (
                    (secretKeyForm.get('confirmSecretKey')?.invalid &&
                      secretKeyForm.get('confirmSecretKey')?.touched) ||
                    hasSecretKeyMismatch
                  ) {
                    <div class="error-message">
                      @if (secretKeyForm.get('confirmSecretKey')?.errors?.['required']) {
                        <span>Secret Key confirmation is required</span>
                      }
                      @if (hasSecretKeyMismatch) {
                        <span>Secret Keys do not match</span>
                      }
                    </div>
                  }
                </div>

                @if (showAdvancedSettings()) {
                  <div class="settings__advanced-section" formGroupName="advancedSettings">
                    <div class="settings__advanced-header">
                      <h3 class="settings__advanced-title">
                        <i class="lucide icon-settings" aria-hidden="true"></i>
                        Encryption Configuration
                      </h3>
                      <p class="settings__advanced-description">
                        Configure cryptographic parameters. Default values are recommended for most
                        users.
                      </p>
                    </div>

                    <div class="settings__advanced-grid">
                      <!-- Algorithm -->
                      <div class="form-group">
                        <label for="algorithm" class="form-label">
                          Encryption Algorithm
                          <span class="settings__field-help">Algorithm for data encryption</span>
                        </label>
                        <select id="algorithm" app-input formControlName="algorithm">
                          <option value="AES-GCM">AES-GCM (Recommended)</option>
                          <option value="AES-CBC">AES-CBC</option>
                        </select>
                      </div>

                      <!-- Hash Algorithm -->
                      <div class="form-group">
                        <label for="hash" class="form-label">
                          Hash Algorithm
                          <span class="settings__field-help">Hash function for key derivation</span>
                        </label>
                        <select id="hash" app-input formControlName="hash">
                          <option value="SHA-256">SHA-256 (Recommended)</option>
                          <option value="SHA-384">SHA-384</option>
                          <option value="SHA-512">SHA-512</option>
                        </select>
                      </div>

                      <!-- Derivation Algorithm -->
                      <div class="form-group">
                        <label for="derivationAlgorithm" class="form-label">
                          Derivation Algorithm
                          <span class="settings__field-help">Key derivation function (KDF)</span>
                        </label>
                        <select
                          id="derivationAlgorithm"
                          app-input
                          formControlName="derivationAlgorithm"
                        >
                          <option value="PBKDF2">PBKDF2</option>
                        </select>
                      </div>

                      <!-- Key Length -->
                      <div class="form-group">
                        <label for="length" class="form-label">
                          Key Length (bits)
                          <span class="settings__field-help">Encryption key size</span>
                        </label>
                        <select id="length" app-input formControlName="length">
                          <option value="128">128 bits</option>
                          <option value="192">192 bits</option>
                          <option value="256">256 bits (Recommended)</option>
                        </select>
                        @if (
                          secretKeyForm.get('advancedSettings.length')?.invalid &&
                          secretKeyForm.get('advancedSettings.length')?.touched
                        ) {
                          <div class="error-message">
                            <span>Key length must be at least 128 bits</span>
                          </div>
                        }
                      </div>

                      <!-- Iterations -->
                      <div class="form-group">
                        <label for="iterations" class="form-label">
                          Iterations
                          <span class="settings__field-help"
                            >Higher values = slower but more secure (min: 100,000)</span
                          >
                        </label>
                        <input
                          id="iterations"
                          type="number"
                          app-input
                          formControlName="iterations"
                          min="100000"
                          step="10000"
                          [class.error]="
                            secretKeyForm.get('advancedSettings.iterations')?.invalid &&
                            secretKeyForm.get('advancedSettings.iterations')?.touched
                          "
                        />
                        @if (
                          secretKeyForm.get('advancedSettings.iterations')?.invalid &&
                          secretKeyForm.get('advancedSettings.iterations')?.touched
                        ) {
                          <div class="error-message">
                            <span>Iterations must be at least 100,000</span>
                          </div>
                        }
                      </div>

                      <!-- Salt Size -->
                      <div class="form-group">
                        <label for="saltSize" class="form-label">
                          Salt Size (bytes)
                          <span class="settings__field-help"
                            >Random data added to prevent rainbow table attacks (min: 16)</span
                          >
                        </label>
                        <input
                          id="saltSize"
                          type="number"
                          app-input
                          formControlName="saltSize"
                          min="16"
                          step="1"
                          [class.error]="
                            secretKeyForm.get('advancedSettings.saltSize')?.invalid &&
                            secretKeyForm.get('advancedSettings.saltSize')?.touched
                          "
                        />
                        @if (
                          secretKeyForm.get('advancedSettings.saltSize')?.invalid &&
                          secretKeyForm.get('advancedSettings.saltSize')?.touched
                        ) {
                          <div class="error-message">
                            <span>Salt size must be at least 16 bytes</span>
                          </div>
                        }
                      </div>
                    </div>

                    <div class="settings__advanced-warning">
                      <i class="lucide icon-alert-triangle" aria-hidden="true"></i>
                      <span
                        >Warning: Custom settings may affect security. Only modify if you understand
                        the implications.</span
                      >
                    </div>
                  </div>
                }

                <div class="settings__form-actions">
                  <button
                    type="submit"
                    app-button
                    zType="default"
                    zSize="default"
                    [disabled]="creatingSecretKey()"
                  >
                    {{ creatingSecretKey() ? 'Saving...' : 'Save Secret Key' }}
                  </button>
                </div>
              </form>
            }
          </div>
        </div>
      </div>

      <!-- Seção Backup -->
      <div class="settings__section">
        <h2 class="settings__section-title">
          <i class="lucide icon-database" aria-hidden="true"></i>
          Backup and Synchronization
        </h2>
        <div class="settings__section-content">
          <div class="settings__item">
            <div class="settings__toggle">
              <input type="checkbox" id="auto-backup" class="settings__checkbox" />
              <label for="auto-backup" class="settings__toggle-label"> Automatic backup </label>
            </div>
          </div>

          <div class="settings__actions">
            <button class="settings__btn settings__btn--secondary">
              <i class="lucide icon-download" aria-hidden="true"></i>
              Export Data
            </button>
            <button class="settings__btn settings__btn--secondary">
              <i class="lucide icon-upload" aria-hidden="true"></i>
              Import Data
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
